{{#loadECharts}}
function dflibEchartLoad_{{id}}(src, currentScript) {
  const savedDefine = window.define;
  const savedAmd = savedDefine && savedDefine.amd;

  // Temporarily disable AMD detection so UMD chooses globalThis/window branch
  if (savedDefine && savedAmd) {
    try { delete savedDefine.amd; } catch { savedDefine.amd = undefined; }
  }

  return new Promise((resolve, reject) => {
    const s = document.createElement("script");
    s.src = src;

    s.onload = () => {
      // restore AMD flag
      if (savedDefine) savedDefine.amd = savedAmd;

      // verify
      if (window.echarts && typeof window.echarts.init === "function") resolve(window.echarts);
      else reject(new Error("ECharts loaded, but window.echarts.init is missing"));
    };

    s.onerror = (e) => {
      // restore AMD flag
      if (savedDefine) savedDefine.amd = savedAmd;
      reject(e);
    };

    // insert safely even if currentScript becomes detached
    const parent = currentScript && currentScript.parentNode;
    if (parent) parent.insertBefore(s, currentScript);
    else (document.head || document.documentElement).appendChild(s);
  });
}

(async function () {
    const cs = document.currentScript;
    if (!window.echarts || !window.echarts.init) {
        await dflibEchartLoad_{{id}}('{{{echartsUrl}}}', cs);

        if (!window.echarts || !window.echarts.init) {
            console.error('ECharts failed to load!');
            return;
        }
    }

    {{#themeUrls}}
    await dflibEchartLoad_{{id}}('{{{.}}}', cs);
    {{/themeUrls}}

    {{#maps}}
        window.echarts.registerMap('{{key}}', {
            geoJSON: {{{value}}}
        });
    {{/maps}}

{{/loadECharts}}
{{#chart}}
var chart_{{id}} = echarts.init(
        document.getElementById('{{id}}'),
        {{{themeOrNull}}},
    {{#initOpts}}
        {
            {{#renderer}}renderer: '{{.}}'{{/renderer}}
        }
    {{/initOpts}}   );
    var option_{{id}} = {
{{#option}}
    {{#title}}
        title: {
        {{#text}}
            text: '{{.}}',
        {{/text}}
        {{#subtext}}
            subtext: '{{.}}',
        {{/subtext}}
        {{#top}}
            top: {{{top}}},
        {{/top}}
        {{#bottom}}
            bottom: {{{bottom}}},
        {{/bottom}}
        {{#left}}
            left: {{{left}}},
        {{/left}}
        {{#right}}
            right: {{{right}}},
        {{/right}}
        },
    {{/title}}
    {{#tooltip}}
        tooltip: {
        {{#trigger}}
            trigger: '{{.}}',
        {{/trigger}}
        {{#axisPointer}}
            axisPointer: {
            {{#type}}
                type: '{{.}}',
            {{/type}}
            }
        {{/axisPointer}}
        },
    {{/tooltip}}
    {{#toolbox}}
        toolbox: {
            feature: {
            {{#dataZoom}}
                dataZoom: {},
            {{/dataZoom}}
            {{#saveAsImage}}
                saveAsImage: {
                {{#pixelRatio}}
                    pixelRatio: {{.}}
                {{/pixelRatio}}
                },
            {{/saveAsImage}}
            {{#restore}}
                restore: {}
            {{/restore}}
            }
        },
    {{/toolbox}}
    {{#legend}}
        legend: {
        {{#show}}
            show: {{show}},
        {{/show}}
        {{#orient}}
            orient: '{{orient}}',
        {{/orient}}
        {{#top}}
            top: {{{top}}},
        {{/top}}
        {{#bottom}}
            bottom: {{{bottom}}},
        {{/bottom}}
        {{#left}}
            left: {{{left}}},
        {{/left}}
        {{#right}}
            right: {{{right}}},
        {{/right}}
        {{#unselectedPresent}}
            selected: {
            {{#unselected}}
                '{{{.}}}': false,
            {{/unselected}}
            },
        {{/unselectedPresent}}
        {{#type}}
            type: '{{type}}'
        {{/type}}
        },
    {{/legend}}
    {{#gridPresent}}
        grid: [
        {{#grid}}
            {
            {{#left}}
                left: {{{.}}},
            {{/left}}
            {{#right}}
                right: {{{.}}},
            {{/right}}
            {{#top}}
                top: {{{.}}},
            {{/top}}
            {{#bottom}}
                bottom: {{{.}}},
            {{/bottom}}
            {{#width}}
                width: {{{.}}},
            {{/width}}
            {{#height}}
                height: {{{.}}},
            {{/height}}
            },
        {{/grid}}
        ],
    {{/gridPresent}}
    {{#dataset}}
        dataset: {
            source: [
                {{#rows}}
                [{{#value}}{{{quotedValue}}}{{^last}},{{/last}}{{/value}}]{{^last}},{{/last}}
                {{/rows}}
            ]
        },
    {{/dataset}}
    {{#visualMapsPresent}}
        visualMap: [
        {{#visualMaps}}
            {
            {{#type}}
                type: '{{.}}',
            {{/type}}
            {{#min}}
                min: {{.}},
            {{/min}}
            {{#max}}
                max: {{.}},
            {{/max}}
            {{#splitNumber}}
                splitNumber: {{.}},
            {{/splitNumber}}
            {{#calculable}}
                calculable: {{.}},
            {{/calculable}}
            {{#orient}}
                orient: '{{.}}',
            {{/orient}}
            {{#left}}
                left: {{{.}}},
            {{/left}}
            {{#right}}
                right: {{{.}}},
            {{/right}}
            {{#top}}
                top: {{{.}}},
            {{/top}}
            {{#bottom}}
                bottom: {{{.}}},
            {{/bottom}}
            {{#itemWidth}}
                itemWidth: {{{.}}},
            {{/itemWidth}}
            {{#itemHeight}}
                itemHeight: {{{.}}},
            {{/itemHeight}}
            {{#showPresent}}
                show: {{show}},
            {{/showPresent}}
            {{#outOfRange}}
                outOfRange: {
                {{#symbol}}
                    symbol: '{{.}}',
                {{/symbol}}
                {{#symbolSize}}
                    symbolSize: {{{.}}},
                {{/symbolSize}}
                {{#color}}
                    color: '{{.}}',
                {{/color}}
                {{#opacity}}
                    opacity: {{{.}}},
                {{/opacity}}
                }
            {{/outOfRange}}
            },
        {{/visualMaps}}
        ],
    {{/visualMapsPresent}}
    {{#calendarsPresent}}
        calendar: [
        {{#calendars}}
        {
            range: ['{{rangeFrom}}','{{rangeTo}}'],
        {{#cellSize}}
            cellSize: {{{.}}},
        {{/cellSize}}
        {{#orient}}
            orient: '{{.}}',
        {{/orient}}
        {{#left}}
            left: {{{.}}},
        {{/left}}
        {{#right}}
            right: {{{.}}},
        {{/right}}
        {{#top}}
            top: {{{.}}},
        {{/top}}
        {{#bottom}}
            bottom: {{{.}}},
        {{/bottom}}
        {{#width}}
            width: {{{.}}},
        {{/width}}
        {{#height}}
            height: {{{.}}},
        {{/height}}
        {{#yearLabel}}
            yearLabel: {
            {{#showPresent}}
                show: {{show}},
            {{/showPresent}}
            {{#color}}
                color: '{{.}}',
            {{/color}}
            },
        {{/yearLabel}}
        },
        {{/calendars}}
        ],
    {{/calendarsPresent}}
    {{#geo}}
        geo: {
        {{#showPresent}}
            show: {{show}},
        {{/showPresent}}
        {{#map}}
            map: '{{.}}',
        {{/map}}
        {{#nameProperty}}
            nameProperty: '{{.}}',
        {{/nameProperty}}
        {{#center}}
            center: [{{{lon}}},{{{lat}}}],
        {{/center}}
        {{#zoom}}
            zoom: {{.}},
        {{/zoom}}
        {{#roamPresent}}
            roam: {{roam}},
        {{/roamPresent}}
        {{#aspectScale}}
            aspectScale: {{.}},
        {{/aspectScale}}
        {{#label}}
            label: {
            {{#showPresent}}
                show: {{show}},
            {{/showPresent}}
            {{#formatter}}
                formatter: '{{.}}',
            {{/formatter}}
            {{#position}}
                position: '{{.}}'
            {{/position}}
            }
        {{/label}}
        },
    {{/geo}}
    {{#xAxesPresent}}
        xAxis: [
        {{#xAxes}}
        {
        {{#alignTicksPresent}}
            alignTicks: {{alignTicks}},
        {{/alignTicksPresent}}
        {{#axisLabel}}
            axisLabel: {
            {{#fontSize}}
                fontSize: {{.}},
            {{/fontSize}}
            {{#fontStyle}}
                fontStyle: '{{.}}',
            {{/fontStyle}}
            {{#fontWeight}}
                fontWeight: {{{.}}},
            {{/fontWeight}}
            {{#fontFamily}}
                fontFamily: '{{.}}',
            {{/fontFamily}}
            {{#formatter}}
                formatter: '{{.}}',
            {{/formatter}}
            {{#rotate}}
                rotate: {{.}}
            {{/rotate}}
            },
        {{/axisLabel}}
        {{#axisLine}}
            axisLine: {
                show: {{show}},
            {{#onZeroPresent}}
                onZero: {{onZero}},
            {{/onZeroPresent}}
            },
        {{/axisLine}}
        {{#noBoundaryGap}}
            boundaryGap: false,
        {{/noBoundaryGap}}
        {{#gridIndex}}
            gridIndex: {{.}},
        {{/gridIndex}}
        {{#name}}
            name: {{{quotedName}}},
        {{/name}}
        {{#offset}}
            offset: {{.}},
        {{/offset}}
        {{#position}}
            position: '{{.}}',
        {{/position}}
        {{#type}}
            type: '{{.}}'
        {{/type}}
        },
        {{/xAxes}}
        ],
    {{/xAxesPresent}}
    {{#yAxesPresent}}
        yAxis: [
        {{#yAxes}}
        {
        {{#alignTicksPresent}}
            alignTicks: {{alignTicks}},
        {{/alignTicksPresent}}
        {{#axisLabel}}
            axisLabel: {
            {{#fontSize}}
                fontSize: {{.}},
            {{/fontSize}}
            {{#fontStyle}}
                fontStyle: '{{.}}',
            {{/fontStyle}}
            {{#fontWeight}}
                fontWeight: {{{.}}},
            {{/fontWeight}}
            {{#fontFamily}}
                fontFamily: '{{.}}',
            {{/fontFamily}}
            {{#formatter}}
                formatter: '{{.}}',
            {{/formatter}}
            {{#rotate}}
                rotate: {{.}}
            {{/rotate}}
            },
        {{/axisLabel}}
        {{#axisLine}}
            axisLine: {
                show: {{show}},
            {{#onZeroPresent}}
                onZero: {{onZero}},
            {{/onZeroPresent}}
            },
        {{/axisLine}}
        {{#noBoundaryGap}}
            boundaryGap: false,
        {{/noBoundaryGap}}
        {{#gridIndex}}
            gridIndex: {{.}},
        {{/gridIndex}}
        {{#name}}
            name: {{{quotedName}}},
        {{/name}}
        {{#offset}}
            offset: {{.}},
        {{/offset}}
        {{#position}}
            position: '{{.}}',
        {{/position}}
        {{#scalePresent}}
            scale: {{scale}},
        {{/scalePresent}}
        {{#type}}
            type: '{{.}}'
        {{/type}}
        },
        {{/yAxes}}
        ],
    {{/yAxesPresent}}
    {{#singleAxesPresent}}
        singleAxis: [
        {{#singleAxes}}
            {
            {{#noBoundaryGap}}
                boundaryGap: false,
            {{/noBoundaryGap}}
            {{#name}}
                name: {{{quotedName}}},
            {{/name}}
            {{#left}}
                left: {{{.}}},
            {{/left}}
            {{#right}}
                right: {{{.}}},
            {{/right}}
            {{#top}}
                top: {{{.}}},
            {{/top}}
            {{#bottom}}
                bottom: {{{.}}},
            {{/bottom}}
            {{#width}}
                width: {{{.}}},
            {{/width}}
            {{#height}}
                height: {{{.}}},
            {{/height}}
            {{#min}}
                min: {{{.}}},
            {{/min}}
            {{#max}}
                max: {{{.}}},
            {{/max}}
            {{#scalePresent}}
                scale: {{scale}},
            {{/scalePresent}}
            {{#type}}
                type: '{{.}}'
            {{/type}}
            },
        {{/singleAxes}}
        ],
    {{/singleAxesPresent}}
        series: [
            {{#series}}
            {
                name: '{{name}}',
            {{#areaStyle}}
                areaStyle: {},
            {{/areaStyle}}
            {{#data}}
                data: [
                {{#rows}}
                    [{{#value}}{{{quotedValue}}}{{^last}},{{/last}}{{/value}}]{{^last}},{{/last}}
                {{/rows}}
                ],
            {{/data}}
            {{#encode}}
                encode: {
                {{#x}}
                    x: {{.}},
                {{/x}}
                {{#ysPresent}}
                    y: [{{#ys}}{{value}}{{^last}},{{/last}}{{/ys}}],
                {{/ysPresent}}
                {{#yPresent}}
                    y: {{y}},
                {{/yPresent}}
                {{#single}}
                    single: {{.}},
                {{/single}}
                {{#lat}}
                    lat: {{.}},
                {{/lat}}
                {{#lon}}
                    lng: {{.}},
                {{/lon}}
                {{#value}}
                    value: {{.}},
                {{/value}}
                {{#itemName}}
                    itemName: {{.}},
                {{/itemName}}
                },
            {{/encode}}
            {{#itemStyle}}
                itemStyle: {
                {{#color}}
                    color: {{{.}}},
                {{/color}}
                {{#color0}}
                    color0: '{{.}}',
                {{/color0}}
                {{#borderColor}}
                    borderColor: '{{.}}',
                {{/borderColor}}
                {{#borderColor0}}
                    borderColor0: '{{.}}',
                {{/borderColor0}}
                {{#borderColorDoji}}
                    borderColorDoji: '{{.}}',
                {{/borderColorDoji}}
                {{#borderRadius}}
                    borderRadius: {{{.}}},
                {{/borderRadius}}
                {{#borderWidth}}
                    borderWidth: {{.}},
                {{/borderWidth}}
                {{#borderType}}
                    borderType: '{{.}}',
                {{/borderType}}
                {{#opacity}}
                    opacity: {{.}}
                {{/opacity}}
                },
            {{/itemStyle}}
            {{#label}}
                label: {
                {{#showPresent}}
                    show: {{show}},
                {{/showPresent}}
                {{#formatter}}
                    formatter: '{{.}}',
                {{/formatter}}
                {{#position}}
                    position: '{{.}}'
                {{/position}}
                },
            {{/label}}
            {{#lineStyle}}
                lineStyle: {
                {{#color}}
                    color: '{{.}}',
                {{/color}}
                {{#width}}
                    width: {{.}},
                {{/width}}
                {{#opacity}}
                    opacity: {{.}},
                {{/opacity}}
                {{#type}}
                    type: '{{.}}'
                {{/type}}
                },
            {{/lineStyle}}
            {{#seriesLayoutBy}}
                seriesLayoutBy: '{{.}}',
            {{/seriesLayoutBy}}
            {{#coordinateSystem}}
                coordinateSystem: '{{.}}',
            {{/coordinateSystem}}
            {{#symbol}}
                symbol: '{{.}}',
            {{/symbol}}
            {{#dontShowSymbol}}
                showSymbol: false,
            {{/dontShowSymbol}}
            {{#smooth}}
                smooth: true,
            {{/smooth}}
            {{#stack}}
                stack: 'total',
            {{/stack}}
            {{#barWidth}}
                barWidth: {{{.}}},
            {{/barWidth}}
            {{#symbolSize}}
                symbolSize: {{{.}}},
            {{/symbolSize}}
            {{#xAxisIndex}}
                xAxisIndex: {{.}},
            {{/xAxisIndex}}
            {{#yAxisIndex}}
                yAxisIndex: {{.}},
            {{/yAxisIndex}}
            {{#singleAxisIndex}}
                singleAxisIndex: {{.}},
            {{/singleAxisIndex}}
            {{#calendarIndex}}
                calendarIndex: {{.}},
            {{/calendarIndex}}
            {{#geoIndex}}
                geoIndex: {{.}},
            {{/geoIndex}}
            {{#radius}}
                radius: {{{radius}}},
            {{/radius}}
            {{#center}}
                center: {{{center}}},
            {{/center}}
            {{#startAngle}}
                startAngle: {{.}},
            {{/startAngle}}
            {{#endAngle}}
                endAngle: {{.}},
            {{/endAngle}}
            {{#roseType}}
                roseType: '{{.}}',
            {{/roseType}}
                type: '{{type}}'
            },
            {{/series}}
        ]
{{/option}}
    };
    option_{{id}} && chart_{{id}}.setOption(option_{{id}});
{{/chart}}
{{#loadECharts}}
})();
{{/loadECharts}}